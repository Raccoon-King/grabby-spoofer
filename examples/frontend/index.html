<!-- Copyright (c) 2024. Licensed under the MIT License. -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MockHub Frontend</title>
</head>
<body>
  <h1>MockHub Tester</h1>
  <section>
    <h2>API Endpoints</h2>
    <ul>
      <li>POST /api/graphql</li>
      <li>GET /api/search?query=&amp;start=0&amp;count=20</li>
      <li>GET /api/entities/{urn}</li>
      <li>POST /api/tags</li>
      <li>POST /api/entities/{urn}/tags</li>
      <li>DELETE /api/entities/{urn}/tags/{tagName}</li>
      <li>GET /api/datasets/{urn}/ownership</li>
      <li>POST /api/datasets/{urn}/ownership</li>
      <li>DELETE /api/datasets/{urn}/ownership/{ownerUrn}</li>
    </ul>
  </section>
  <div>
    <label>Method:
      <select id="method">
        <option>GET</option>
        <option>POST</option>
      </select>
    </label>
  </div>
  <div>
    <label>Path:
      <input id="path" value="/api/search" size="40" />
    </label>
  </div>
  <div>
    <label>Scenario:
      <select id="scenario">
        <option>default</option>
        <option>empty</option>
        <option>partial</option>
        <option>error</option>
        <option>auth</option>
      </select>
    </label>
  </div>
  <div>
    <label>Body:</label><br />
    <textarea id="body" rows="8" cols="60"></textarea>
  </div>
  <button id="send">Send</button>
  <pre id="result"></pre>
  <h2>Logs</h2>
  <pre id="logs"></pre>
  <script>
    document.getElementById('send').addEventListener('click', async () => {
      const method = document.getElementById('method').value;
      const path = document.getElementById('path').value;
      const base = 'http://localhost:3002';
      const url = path.startsWith('http') ? path : base + path;
      const scenario = document.getElementById('scenario').value;
      const body = document.getElementById('body').value;
      const options = { method, headers: { 'X-Mock-Scenario': scenario } };
      if (method === 'POST') {
        options.headers['Content-Type'] = 'application/json';
        options.body = body;
      }
      try {
        const res = await fetch(url, options);
        const text = await res.text();
        document.getElementById('result').textContent = text;
      } catch (err) {
        document.getElementById('result').textContent = err;
      }
    });

    async function refreshLogs() {
      try {
        const res = await fetch('/logs');
        const text = await res.text();
        document.getElementById('logs').textContent = text;
      } catch (err) {
        document.getElementById('logs').textContent = err;
      }
    }
    refreshLogs();
    setInterval(refreshLogs, 2000);
  </script>
</body>
</html>
