<!-- Copyright (c) 2024. Licensed under the MIT License. -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Grabby API Frontend</title>
</head>
<body>
  <h1>Grabby API Tester</h1>
  <div>
    <label>Method:
      <select id="method">
        <option>GET</option>
        <option>POST</option>
      </select>
    </label>
  </div>
  <div>
    <label>Path:
      <input id="path" value="/api/search" size="40" />
    </label>
  </div>
  <div>
    <label>Scenario:
      <select id="scenario">
        <option>default</option>
        <option>empty</option>
        <option>partial</option>
        <option>error</option>
        <option>auth</option>
      </select>
    </label>
  </div>
  <div>
    <label>Example:
      <select id="example">
        <option value="">-- choose --</option>
        <option value="graphql-search">GraphQL search</option>
        <option value="rest-tag-create">REST create tag</option>
        <option value="rest-ownership-add">REST add owner</option>
      </select>
    </label>
  </div>
  <div>
    <label>Body:</label><br />
    <textarea id="body" rows="8" cols="60"></textarea>
  </div>
  <button id="send">Send</button>
  <pre id="result"></pre>
  <script>
    const examples = {
      'graphql-search': {
        method: 'POST',
        path: '/api/graphql',
        body: JSON.stringify({ query: 'query { search(input: { query: "test", type: DATASET, start: 0, count: 5 }) { start count total items { urn } } }' }, null, 2)
      },
      'rest-tag-create': {
        method: 'POST',
        path: '/api/tags',
        body: JSON.stringify({ name: 'newTag' }, null, 2)
      },
      'rest-ownership-add': {
        method: 'POST',
        path: '/api/datasets/urn:li:dataset:(urn:li:dataPlatform:hive,SampleDataset,PROD)/ownership',
        body: JSON.stringify({ ownerUrn: 'urn:li:corpuser:jsmith', type: 'DATAOWNER' }, null, 2)
      }
    };

    document.getElementById('example').addEventListener('change', (e) => {
      const ex = examples[e.target.value];
      if (ex) {
        document.getElementById('method').value = ex.method;
        document.getElementById('path').value = ex.path;
        document.getElementById('body').value = ex.body;
      }
    });

    document.getElementById('send').addEventListener('click', async () => {
      const method = document.getElementById('method').value;
      const path = document.getElementById('path').value;
      const base = 'http://localhost:3002';
      const url = path.startsWith('http') ? path : base + path;
      const scenario = document.getElementById('scenario').value;
      const body = document.getElementById('body').value;
      const options = { method, headers: { 'X-Mock-Scenario': scenario } };
      if (method === 'POST') {
        options.headers['Content-Type'] = 'application/json';
        options.body = body;
      }
      try {
        const res = await fetch(url, options);
        const text = await res.text();
        document.getElementById('result').textContent = text;
      } catch (err) {
        document.getElementById('result').textContent = err;
      }
    });
  </script>
</body>
</html>
